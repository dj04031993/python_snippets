
:: ==== BUILD BATCH MESSAGE FILE ====
ECHO Preparing batch message file...
> %TMP_REQUEST_FILE% (
    ECHO 
    ECHO 
)

:: ==== START CONSUMER IN BACKGROUND ====
ECHO Starting consumer in background to listen for new messages...
START "" /B CMD /C "%CONSUMER% --bootstrap-server %BROKER_LIST% --topic %CONSUME_TOPIC% --consumer.config %CONFIG_FILE% --from-beginning --timeout-ms 10000 --max-messages 20 --offset-reset latest > %TMP_RESPONSE_FILE%"

:: ==== GIVE CONSUMER TIME TO ATTACH ====
TIMEOUT /T 2 >NUL

:: ==== SEND MESSAGES ====
ECHO Sending messages to Kafka topic %PRODUCE_TOPIC%
CALL "%PRODUCER%" --broker-list %BROKER_LIST% --topic %PRODUCE_TOPIC% --request-timeout-ms 60000 --producer.config %CONFIG_FILE% < %TMP_REQUEST_FILE% >NUL

:: ==== WAIT FOR RESPONSES ====
ECHO Waiting %WAIT_SECONDS% seconds for consumer to capture messages...
TIMEOUT /T %WAIT_SECONDS% >NUL

:: ==== DISPLAY RESPONSES ====
ECHO -------- Kafka Responses --------
TYPE %TMP_RESPONSE_FILE%

:: ==== CLEANUP ====
DEL %TMP_REQUEST_FILE% 2>NUL
DEL %TMP_RESPONSE_FILE% 2>NUL

PAUSE
ENDLOCAL
